<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>G-CORE GENIE HOST</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Farben wie auf der Hauptseite -->
  <style>
    :root {
      --bg-dark:   #111214;
      --bg-darker: #050506;
      --text-light:#f5f5f7;
      --text-muted:#c8c8c8;
      --gold:      #d7b86f;
      --gold-soft: #d7b86f33;
    }

    /* Layout Container */
.console-container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 22px;
}

/* Überschriften */
.section-title {
    font-size: 1.6rem;
    margin-bottom: 10px;
}

/* Prompt Input */
#prompt-input {
    width: 100%;
    height: 160px;
    font-size: 1rem;
    padding: 15px;
    border-radius: 14px;
}

/* Antwortbox */
#answer-box {
    width: 100%;
    height: 250px;
    padding: 25px;
    overflow-y: auto;
    border-radius: 20px;
}

/* Blöcke links rechts */
.input-section, .output-section {
    padding: 24px;
    height: auto;
    min-height: 260px;
}

/* Modell + Temperatur nebeneinander */
.settings-row {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
}

.settings-block {
    flex: 1;
    min-width: 260px;
}

/* Temperatur-Schieberegler */
#temperature {
    width: 100%;
}

/* Senden-Button */
.send-button {
    width: 190px;
    height: 60px;
    font-size: 1.1rem;
    border-radius: 16px;
    cursor: pointer;
}


  <!-- Manifest & Icons -->
  <link rel="manifest" href="gcore_manifest.json">
  <link rel="icon" type="image/png" sizes="192x192" href="assets_icons/gcore_icon_192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="assets_icons/gcore_icon_512.png">
  <meta name="theme-color" content="#111214">
</head>
<body>
  <main class="host-shell">
    <header class="host-header">
      <div>
        <div class="host-title">G-CORE GENIE HOST CONSOLE</div>
        <div class="host-sub">
          Direkter Testaufruf gegen deinen G-Core Router.
        </div>
      </div>
      <div class="router-pill">
        <span class="router-dot"></span>
        <span>Router aktiv</span>
      </div>
    </header>

    <section class="host-grid">
      <!-- Linke Seite: Router Infos -->
      <aside class="panel">
        <div class="panel-label"><span>G-CORE SYSTEMS</span> · Router</div>
        <ul class="router-list">
          <li>Alle Anfragen laufen über deinen eigenen API-Router.</li>
          <li>Modell und Temperatur steuerst du direkt in der Konsole.</li>
          <li>Antworten kommen im Klartext zurück – ohne technische Details.</li>
          <li>Nutze diese Seite nur für interne Tests deiner Programme.</li>
        </ul>
        <div class="endpoint-pill">
          Endpoint
          <code id="endpointLabel">POST https://api.g-core-systems.com/genie</code>
        </div>
      </aside>

      <!-- Rechte Seite: Genie Host Console -->
      <section class="panel">
        <div class="panel-label"><span>Genie Host Console</span> · Prompt & Antwort</div>

        <div class="console-grid">
          <!-- Prompt -->
          <div>
            <div class="field-label"><span>Prompt</span></div>
            <div class="prompt-box">
              <textarea
                id="promptInput"
                placeholder="Schreibe hier deinen Test-Prompt hinein, zum Beispiel: &#10;„Sag mir bitte in einem Satz, was G-Core Systems aus deiner Sicht besonders macht.“"
              >Was ist ein Orca?</textarea>
            </div>
          </div>

          <!-- Modell & Temperatur -->
          <div class="model-temp-row">
            <div class="card-soft">
              <div class="field-label"><span>Modell</span></div>
              <div class="model-select-wrap select-shell">
                <select id="modelSelect">
                  <option value="gpt-4.1-mini">gpt-4.1-mini</option>
                  <option value="gpt-4.1">gpt-4.1</option>
                  <option value="gpt-4.1-nano">gpt-4.1-nano</option>
                </select>
              </div>
            </div>
            <div class="card-soft">
              <div class="field-label"><span>Temperatur</span></div>
              <div class="slider-wrap">
                <input
                  id="tempRange"
                  type="range"
                  min="0"
                  max="1"
                  step="0.1"
                  value="0.7"
                >
                <div class="temp-value" id="tempValueLabel">
                  Aktuelle Einstellung: 0.7
                </div>
              </div>
            </div>
          </div>

          <!-- Antwort -->
          <div>
            <div class="field-label"><span>Antwort von Genie</span></div>
            <div class="answer-box-wrapper">
              <div id="answerBox">
                Noch keine Antwort erhalten.
              </div>
            </div>
          </div>

          <!-- Button + Status -->
          <div class="send-row">
            <button
              type="button"
              class="btn-send"
              id="sendButton"
              onclick="sendPrompt()"
            >
              <span class="icon">➜</span>
              <span>Senden</span>
            </button>
            <div class="status-line">
              <span id="statusMessage">
                Bereit. Aktives Modell: <strong id="activeModelLabel">gpt-4.1-mini</strong>.
              </span>
            </div>
          </div>
        </div>

        <div class="footline">
          Alle Antworten laufen über deinen <span>G-Core Router</span>.
        </div>
      </section>
    </section>
  </main>

  <script>
    const API_URL = "https://api.g-core-systems.com/genie";

    function updateTempLabel() {
      const range = document.getElementById("tempRange");
      const label = document.getElementById("tempValueLabel");
      if (range && label) {
        label.textContent = "Aktuelle Einstellung: " + range.value;
      }
    }

    function updateActiveModelLabel() {
      const select = document.getElementById("modelSelect");
      const label = document.getElementById("activeModelLabel");
      if (select && label) {
        label.textContent = select.value;
      }
    }

    async function sendPrompt() {
      const promptEl = document.getElementById("promptInput");
      const modelEl = document.getElementById("modelSelect");
      const tempEl = document.getElementById("tempRange");
      const answerBox = document.getElementById("answerBox");
      const statusEl = document.getElementById("statusMessage");

      const prompt = promptEl.value.trim();
      if (!prompt) {
        statusEl.innerHTML = '<span class="error">Bitte gib zuerst einen Prompt ein.</span>';
        return;
      }

      statusEl.textContent = "Sende Anfrage an Genie …";
      answerBox.textContent = "Warte auf Antwort …";

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            prompt,
            model: modelEl.value,
            temperature: Number(tempEl.value),
          }),
        });

        let data;
        try {
          data = await res.json();
        } catch (e) {
          const text = await res.text();
          data = text;
        }

        console.log("Genie raw response:", data);

        // Antwort-Text extrahieren
        let replyText = "";

        if (typeof data === "string") {
          try {
            data = JSON.parse(data);
          } catch {
            // bleibt String
          }
        }

        if (data && typeof data === "object") {
          // 1) Dein Router-Format: { ok: true, model: "...", response: "..." }
          if (data.response) {
            replyText = data.response;
          }
          // 2) OpenAI-Style: { choices: [ { message: { content: "..." } } ] }
          else if (data.choices && data.choices[0]?.message?.content) {
            replyText = data.choices[0].message.content;
          }
          // 3) message.content[] (z.B. Werkzeuge)
          else if (data.message && Array.isArray(data.message.content)) {
            const textPart = data.message.content.find(
              (p) => p.type === "output_text" || p.type === "text"
            );
            if (textPart) {
              replyText = textPart.text || textPart.content || "";
            }
          }
          // 4) Fehlerstruktur
          else if (data.ok === false && data.error) {
            replyText = data.error.message || JSON.stringify(data.error, null, 2);
          }
        }

        // Fallback: alles anzeigen, falls nicht eindeutig
        if (!replyText) {
          if (typeof data === "string") {
            replyText = data;
          } else {
            replyText = JSON.stringify(data, null, 2);
          }
        }

        // Ausgabe
        answerBox.innerHTML = replyText.replace(/\n/g, "<br>");
        statusEl.innerHTML =
          'Antwort erfolgreich von Genie erhalten. Aktives Modell: <strong>' +
          modelEl.value +
          "</strong>.";
      } catch (err) {
        console.error(err);
        statusEl.innerHTML =
          '<span class="error">Fehler: Die Anfrage konnte nicht gesendet werden.</span>';
        answerBox.textContent = err.message || String(err);
      }
    }

    // Initialisieren
    document.addEventListener("DOMContentLoaded", () => {
      const tempRange = document.getElementById("tempRange");
      const modelSelect = document.getElementById("modelSelect");

      if (tempRange) {
        tempRange.addEventListener("input", updateTempLabel);
        updateTempLabel();
      }

      if (modelSelect) {
        modelSelect.addEventListener("change", updateActiveModelLabel);
        updateActiveModelLabel();
      }

      // Service Worker für PWA registrieren (optional, falls sw.js vorhanden)
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("sw.js")
          .catch((err) => console.warn("SW Registrierung fehlgeschlagen:", err));
      }
    });
  </script>
</body>
</html>
