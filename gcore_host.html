<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>G-CORE GENIE HOST</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Farben wie auf der Hauptseite -->
  <style>
    :root {
      --bg-dark:   #111214;
      --bg-darker: #050506;
      --text-light:#f5f5f7;
      --text-muted:#c8c8c8;
      --gold:      #d7b86f;
      --gold-soft: #d7b86f33;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
    }

    body {
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-light);
      background:
        radial-gradient(circle at top, #1d1f24 0, var(--bg-dark) 45%, var(--bg-darker) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    main.host-shell {
      max-width: 1200px;
      width: 100%;
      background: linear-gradient(145deg, #191b20, #0b0c10);
      border-radius: 32px;
      padding: 32px 32px 28px;
      position: relative;
      box-shadow:
        0 30px 80px rgba(0, 0, 0, 0.7),
        0 0 0 1px rgba(255, 255, 255, 0.02);
    }

    .host-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      margin-bottom: 26px;
      gap: 16px;
    }

    .host-title {
      font-size: 22px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--gold);
    }

    .host-sub {
      font-size: 13px;
      color: var(--text-muted);
    }

    .router-pill {
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid rgba(0, 0, 0, 0.6);
      background: radial-gradient(circle at left, #2fd26f44, #121518);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .router-dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      background: #2fd26f;
      box-shadow: 0 0 12px #2fd26f;
    }

    .router-pill span {
      color: #b9f3cd;
    }

    /* Layout */

    .host-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.6fr);
      gap: 24px;
    }

    .panel {
      border-radius: 26px;
      padding: 22px 22px 20px;
      background: radial-gradient(circle at top, #20222a, #111319);
      box-shadow:
        0 18px 40px rgba(0, 0, 0, 0.7),
        0 0 0 1px rgba(255, 255, 255, 0.02);
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      border: 1px solid rgba(255, 255, 255, 0.03);
      pointer-events: none;
    }

    .panel-label {
      font-size: 11px;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .panel-label span {
      color: var(--gold);
    }

    /* Router Info links */

    .router-list {
      list-style: none;
      font-size: 13px;
      color: var(--text-muted);
      display: grid;
      gap: 8px;
      padding-left: 0;
      margin-top: 4px;
    }

    .router-list li {
      position: relative;
      padding-left: 14px;
    }

    .router-list li::before {
      content: "•";
      position: absolute;
      left: 0;
      top: 0;
      color: var(--gold);
    }

    .endpoint-pill {
      margin-top: 14px;
      font-size: 11px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .endpoint-pill code {
      display: inline-block;
      margin-top: 6px;
      border-radius: 999px;
      padding: 6px 12px;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.06);
      font-size: 11px;
      color: var(--gold);
      white-space: nowrap;
    }

    /* Console rechts */

    .console-grid {
      display: grid;
      grid-template-rows: auto auto minmax(0, 1fr) auto;
      gap: 16px;
      height: 100%;
    }

    /* Prompt & Antwort – große Felder */

    .field-label {
      font-size: 11px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .field-label span {
      color: var(--gold);
    }

    .prompt-box,
    .answer-box-wrapper {
      border-radius: 18px;
      padding: 14px 14px 12px;
      background: rgba(0, 0, 0, 0.42);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    textarea#promptInput {
      width: 100%;
      border: none;
      outline: none;
      resize: vertical;
      min-height: 200px;
      max-height: 400px;
      padding: 8px 10px;
      border-radius: 12px;
      background: rgba(10, 10, 12, 0.9);
      color: var(--text-light);
      font-size: 15px;
      line-height: 1.5;
    }

    textarea#promptInput::placeholder {
      color: #777b84;
    }

    #answerBox {
      width: 100%;
      min-height: 230px;
      max-height: 420px;
      padding: 10px 10px 8px;
      border-radius: 12px;
      background: rgba(10, 10, 12, 0.9);
      color: var(--text-light);
      font-size: 15px;
      line-height: 1.5;
      overflow-y: auto;
      white-space: pre-wrap;
    }

    /* Modell + Temperatur */

    .model-temp-row {
      display: grid;
      grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.1fr);
      gap: 12px;
    }

    .card-soft {
      border-radius: 18px;
      padding: 12px 14px 12px;
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.04), rgba(0, 0, 0, 0.5));
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .model-select-wrap {
      margin-top: 6px;
    }

    select#modelSelect {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(0, 0, 0, 0.7);
      background: radial-gradient(circle at top, #2b2d35, #15171d);
      color: var(--text-light);
      padding: 8px 12px;
      font-size: 13px;
      outline: none;
      appearance: none;
      position: relative;
    }

    select#modelSelect option {
      background: #15171d;
      color: var(--text-light);
    }

    .select-shell {
      position: relative;
    }

    .select-shell::after {
      content: "▾";
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 11px;
      color: var(--gold);
      pointer-events: none;
    }

    .slider-wrap {
      margin-top: 6px;
    }

    .temp-value {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    input[type="range"] {
      width: 100%;
      -webkit-appearance: none;
      appearance: none;
      height: 6px;
      border-radius: 10px;
      background: rgba(0, 0, 0, 0.6);
      outline: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--gold);
      box-shadow: 0 0 10px rgba(215, 184, 111, 0.9);
      cursor: pointer;
      border: 2px solid rgba(0, 0, 0, 0.6);
      margin-top: -5px;
    }

    input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--gold);
      box-shadow: 0 0 10px rgba(215, 184, 111, 0.9);
      cursor: pointer;
      border: 2px solid rgba(0, 0, 0, 0.6);
    }

    /* Button + Status */

    .send-row {
      margin-top: 4px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .btn-send {
      position: relative;
      border-radius: 999px;
      border: none;
      padding: 11px 28px 11px 24px;
      font-size: 13px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #1b1306;
      background: radial-gradient(circle at top, #ffe5a7, #f5c96c);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      box-shadow:
        0 14px 30px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(0, 0, 0, 0.6);
      white-space: nowrap;
    }

    .btn-send .icon {
      font-size: 14px;
    }

    .btn-send:active {
      transform: translateY(1px);
      box-shadow:
        0 8px 18px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(0, 0, 0, 0.7);
    }

    .status-line {
      font-size: 12px;
      color: var(--text-muted);
    }

    .status-line strong {
      color: var(--gold);
      font-weight: 500;
    }

    .status-line .error {
      color: #ff8f8f;
    }

    .footline {
      margin-top: 10px;
      font-size: 11px;
      color: var(--text-muted);
      text-align: right;
    }

    .footline span {
      color: var(--gold);
    }

    /* Responsive */

    @media (max-width: 900px) {
      main.host-shell {
        padding: 22px 18px 20px;
        border-radius: 24px;
      }

      .host-grid {
        grid-template-columns: 1fr;
      }

      .console-grid {
        grid-template-rows: auto auto minmax(0, 1fr) auto;
      }

      textarea#promptInput {
        min-height: 180px;
      }

      #answerBox {
        min-height: 210px;
      }

      .send-row {
        flex-direction: column-reverse;
        align-items: flex-start;
      }
    }
  </style>

  <!-- Manifest & Icons -->
  <link rel="manifest" href="gcore_manifest.json">
  <link rel="icon" type="image/png" sizes="192x192" href="assets_icons/gcore_icon_192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="assets_icons/gcore_icon_512.png">
  <meta name="theme-color" content="#111214">
</head>
<body>
  <main class="host-shell">
    <header class="host-header">
      <div>
        <div class="host-title">G-CORE GENIE HOST CONSOLE</div>
        <div class="host-sub">
          Direkter Testaufruf gegen deinen G-Core Router.
        </div>
      </div>
      <div class="router-pill">
        <span class="router-dot"></span>
        <span>Router aktiv</span>
      </div>
    </header>

    <section class="host-grid">
      <!-- Linke Seite: Router Infos -->
      <aside class="panel">
        <div class="panel-label"><span>G-CORE SYSTEMS</span> · Router</div>
        <ul class="router-list">
          <li>Alle Anfragen laufen über deinen eigenen API-Router.</li>
          <li>Modell und Temperatur steuerst du direkt in der Konsole.</li>
          <li>Antworten kommen im Klartext zurück – ohne technische Details.</li>
          <li>Nutze diese Seite nur für interne Tests deiner Programme.</li>
        </ul>
        <div class="endpoint-pill">
          Endpoint
          <code id="endpointLabel">POST https://api.g-core-systems.com/genie</code>
        </div>
      </aside>

      <!-- Rechte Seite: Genie Host Console -->
      <section class="panel">
        <div class="panel-label"><span>Genie Host Console</span> · Prompt & Antwort</div>

        <div class="console-grid">
          <!-- Prompt -->
          <div>
            <div class="field-label"><span>Prompt</span></div>
            <div class="prompt-box">
              <textarea
                id="promptInput"
                placeholder="Schreibe hier deinen Test-Prompt hinein, zum Beispiel: &#10;„Sag mir bitte in einem Satz, was G-Core Systems aus deiner Sicht besonders macht.“"
              >Was ist ein Orca?</textarea>
            </div>
          </div>

          <!-- Modell & Temperatur -->
          <div class="model-temp-row">
            <div class="card-soft">
              <div class="field-label"><span>Modell</span></div>
              <div class="model-select-wrap select-shell">
                <select id="modelSelect">
                  <option value="gpt-4.1-mini">gpt-4.1-mini</option>
                  <option value="gpt-4.1">gpt-4.1</option>
                  <option value="gpt-4.1-nano">gpt-4.1-nano</option>
                </select>
              </div>
            </div>
            <div class="card-soft">
              <div class="field-label"><span>Temperatur</span></div>
              <div class="slider-wrap">
                <input
                  id="tempRange"
                  type="range"
                  min="0"
                  max="1"
                  step="0.1"
                  value="0.7"
                >
                <div class="temp-value" id="tempValueLabel">
                  Aktuelle Einstellung: 0.7
                </div>
              </div>
            </div>
          </div>

          <!-- Antwort -->
          <div>
            <div class="field-label"><span>Antwort von Genie</span></div>
            <div class="answer-box-wrapper">
              <div id="answerBox">
                Noch keine Antwort erhalten.
              </div>
            </div>
          </div>

          <!-- Button + Status -->
          <div class="send-row">
            <button
              type="button"
              class="btn-send"
              id="sendButton"
              onclick="sendPrompt()"
            >
              <span class="icon">➜</span>
              <span>Senden</span>
            </button>
            <div class="status-line">
              <span id="statusMessage">
                Bereit. Aktives Modell: <strong id="activeModelLabel">gpt-4.1-mini</strong>.
              </span>
            </div>
          </div>
        </div>

        <div class="footline">
          Alle Antworten laufen über deinen <span>G-Core Router</span>.
        </div>
      </section>
    </section>
  </main>

  <script>
    const API_URL = "https://api.g-core-systems.com/genie";

    function updateTempLabel() {
      const range = document.getElementById("tempRange");
      const label = document.getElementById("tempValueLabel");
      if (range && label) {
        label.textContent = "Aktuelle Einstellung: " + range.value;
      }
    }

    function updateActiveModelLabel() {
      const select = document.getElementById("modelSelect");
      const label = document.getElementById("activeModelLabel");
      if (select && label) {
        label.textContent = select.value;
      }
    }

    async function sendPrompt() {
      const promptEl = document.getElementById("promptInput");
      const modelEl = document.getElementById("modelSelect");
      const tempEl = document.getElementById("tempRange");
      const answerBox = document.getElementById("answerBox");
      const statusEl = document.getElementById("statusMessage");

      const prompt = promptEl.value.trim();
      if (!prompt) {
        statusEl.innerHTML = '<span class="error">Bitte gib zuerst einen Prompt ein.</span>';
        return;
      }

      statusEl.textContent = "Sende Anfrage an Genie …";
      answerBox.textContent = "Warte auf Antwort …";

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            prompt,
            model: modelEl.value,
            temperature: Number(tempEl.value),
          }),
        });

        let data;
        try {
          data = await res.json();
        } catch (e) {
          const text = await res.text();
          data = text;
        }

        console.log("Genie raw response:", data);

        // Antwort-Text extrahieren
        let replyText = "";

        if (typeof data === "string") {
          try {
            data = JSON.parse(data);
          } catch {
            // bleibt String
          }
        }

        if (data && typeof data === "object") {
          // 1) Dein Router-Format: { ok: true, model: "...", response: "..." }
          if (data.response) {
            replyText = data.response;
          }
          // 2) OpenAI-Style: { choices: [ { message: { content: "..." } } ] }
          else if (data.choices && data.choices[0]?.message?.content) {
            replyText = data.choices[0].message.content;
          }
          // 3) message.content[] (z.B. Werkzeuge)
          else if (data.message && Array.isArray(data.message.content)) {
            const textPart = data.message.content.find(
              (p) => p.type === "output_text" || p.type === "text"
            );
            if (textPart) {
              replyText = textPart.text || textPart.content || "";
            }
          }
          // 4) Fehlerstruktur
          else if (data.ok === false && data.error) {
            replyText = data.error.message || JSON.stringify(data.error, null, 2);
          }
        }

        // Fallback: alles anzeigen, falls nicht eindeutig
        if (!replyText) {
          if (typeof data === "string") {
            replyText = data;
          } else {
            replyText = JSON.stringify(data, null, 2);
          }
        }

        // Ausgabe
        answerBox.innerHTML = replyText.replace(/\n/g, "<br>");
        statusEl.innerHTML =
          'Antwort erfolgreich von Genie erhalten. Aktives Modell: <strong>' +
          modelEl.value +
          "</strong>.";
      } catch (err) {
        console.error(err);
        statusEl.innerHTML =
          '<span class="error">Fehler: Die Anfrage konnte nicht gesendet werden.</span>';
        answerBox.textContent = err.message || String(err);
      }
    }

    // Initialisieren
    document.addEventListener("DOMContentLoaded", () => {
      const tempRange = document.getElementById("tempRange");
      const modelSelect = document.getElementById("modelSelect");

      if (tempRange) {
        tempRange.addEventListener("input", updateTempLabel);
        updateTempLabel();
      }

      if (modelSelect) {
        modelSelect.addEventListener("change", updateActiveModelLabel);
        updateActiveModelLabel();
      }

      // Service Worker für PWA registrieren (optional, falls sw.js vorhanden)
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("sw.js")
          .catch((err) => console.warn("SW Registrierung fehlgeschlagen:", err));
      }
    });
  </script>
</body>
</html>
